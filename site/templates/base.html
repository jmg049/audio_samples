<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% if page.title %}{{ page.title }} ‚Äì {% endif %}{{ config.title }}</title>
    <meta name="description" content="{{ config.description }}" />

    <link rel="stylesheet" href="{{ get_url(path='style.css') | safe }}" />
  </head>

  <body>
    <header>
      <div class="header-content">
        <h1><a href="{{ config.base_url }}">{{ config.title }}</a></h1>
        <div class="theme-controls">
          <select id="theme-select" class="theme-select" aria-label="Select theme">
            <option value="modern">Modern</option>
            <option value="minimal">Minimal</option>
            <option value="academic">Academic</option>
            <option value="retro">Retro</option>
            <option value="high-contrast">High Contrast</option>
          </select>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
            <span class="theme-toggle-light">‚òÄÔ∏è</span>
            <span class="theme-toggle-dark">üåô</span>
          </button>
        </div>
      </div>
    </header>

    <main>
      {% block content %}{% endblock %}
    </main>

    <footer>
      <small>&copy; {{ now() | date(format="%Y") }} {{ config.extra.author }}</small>
    </footer>
    
    <script>
      (function() {
        const toggle = document.getElementById('theme-toggle');
        const select = document.getElementById('theme-select');
        const html = document.documentElement;
        const themeKey = 'theme-variant';
        const darkKey = 'theme-dark';
        
        // Check localStorage or system preference
        const storedTheme = localStorage.getItem(themeKey) || 'modern';
        const storedDark = localStorage.getItem(darkKey);
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDark = storedDark === 'true' || (!storedDark && systemDark);
        
        // Set initial theme
        const initialTheme = isDark ? storedTheme + ' dark' : storedTheme;
        html.setAttribute('data-theme', initialTheme);
        select.value = storedTheme;
        
        // Theme variant selector
        select.addEventListener('change', () => {
          const newTheme = select.value;
          const currentDark = html.getAttribute('data-theme').includes('dark');
          const newFullTheme = currentDark ? newTheme + ' dark' : newTheme;
          html.setAttribute('data-theme', newFullTheme);
          localStorage.setItem(themeKey, newTheme);
        });
        
        // Dark mode toggle
        toggle.addEventListener('click', () => {
          const currentTheme = html.getAttribute('data-theme');
          const currentVariant = currentTheme.replace(' dark', '');
          const isDark = currentTheme.includes('dark');
          const newTheme = isDark ? currentVariant : currentVariant + ' dark';
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem(darkKey, (!isDark).toString());
        });
      })();
    </script>
  </body>
</html>
